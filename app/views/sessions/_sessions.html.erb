<% content_for :header do %>
  <% javascript_tag do %>
    function bookSession(path){
      document.location.href = path
    }
  <% end %>
<% end %>


<table class="session-list">
  
  <colgroup>
  <col width="200">
  <col width="150">
  <col width="10*">
  </colgroup>
<%-   
  past_week = nil 
-%>
<%- sessions.each_with_index do |session, index| -%>
  <%- 
    week = session.starts_at.to_date.cweek.to_i
    new_week = week != past_week
    past_week = week
    end_week = session == sessions.last || week != sessions[index+1].starts_at.to_date.cweek.to_i
  -%>
  <%- if new_week -%>
  <thead>
    <tr>
        <td colspan="3" style="padding-top:30px;border-bottom:1px solid rgb(200,200,200)">Vecka <%= week %></td>
    </tr>
  </thead>
  <%- end -%>
  <%- if new_week -%>
  <tbody class="gradient-back">
  <%- end -%>
    <tr<%= ' class="canceled-session"' if session.canceled? %>>
        <td nowrap style="padding-left:10px">
          <%=l(session.date, :format => :long_day)  %>
        </td>
        <td nowrap style="padding-left:10px">
          <%=l session.starts_at, :format => :time %> – <%=l session.ends_at, :format => :time %>
        </td>
        <%- path_to_booking = (defined?(booking_proc) and booking_proc.is_a?(Proc)) ? booking_proc.call(session) : book_session_path(session) -%>
        <td nowrap style="padding-left:10px" align="left">
          <%- if !session.canceled? && !session.expired? -%>
          <%= link_to "Reservera plats", path_to_booking  %>
          <%= link_to 'Läs mer...', session, :class => 'read-more' %>
          <%- elsif !session.expired? -%>
          <%= session.comment %>
          <%- end -%>
        </td>
    </tr>
  <%- if session.comment? and !session.canceled? -%>
    <tr>
        <td colspan="3" class="session-list-comment"><%= session.comment %></td>
    </tr>
    
  <%- end -%>
  <%- if end_week -%>
  </tbody>
  <%- end -%>
<%- end -%>
</table>
