<% id_prefix = "participand_index_0_" %>
<% booking_name = "session[bookings_attributes][#{index}]" %>
<% participant_name = "#{booking_name}[participant_attributes]" %>
<% payment_name = "#{booking_name}[payment_attributes][reciept_attributes]" %>
<% radio_name = "#{payment_name}[type]" %>

<% if opt(:participant){ false } %>
  <%= hidden_field_tag "#{booking_name}[id]", participant.booking.id   %>
  <%= hidden_field_tag "#{booking_name}[payment_attribute][id]", participant.booking.payment.id   %>
  <%= hidden_field_tag "#{participant_name}[0][id]", participant.id   %>
  <%= hidden_field_tag "#{participant_name}[attendants_attributes][0][id]", participant.attendant.id   %>
<% end %>
<li style="list-style:none">
  <%= check_box_tag "#{participant_name}[attendants_attributes][0][status]", 1, 0   %>
  <%= hidden_field_tag "#{participant_name}[attendants_attributes][0][session_id]", session.id   %>
  <%= text_field_tag "#{participant_name}[name]", ( participant.name if opt(:participant){ false }) %>
  <%= select_tag("#{radio_name}", options_for_select([['Obetalt', 'none'],['Kontant', 'cash'],['Kupong', 'coupon'],['Gratis', 'free']], :selected => (participant.payment.type if opt(:participant){ false })), :onchange => 'participant_payment_options(this)') %>
  <%= link_to_function "Ta bort", "$(this).closest('li').remove()" %>
  |
  <%= link_to_function 'Kommentar', "$('##{id_prefix}_comment').toggle()" %><br />
  <p style="display:none" id="<%= id_prefix %>_comment">
  <%= text_area_tag "#{participant_name}[attendants_attributes][0][comment]", '', :rows => 4 %>
  </p>

  <div style="margin:5px 0 0 20px;">
    <span id="<%= radio_name %>_options">
      <span id="<%= radio_name %>_cash" style="display:none">
        <%= text_field_tag "#{payment_name}[cash][gross]", nil, :placeholder => 'VÃ¤rde' %>
      </span>
      <span id="<%= radio_name %>_coupon" style="display:none">
        <%= select_tag "#{payment_name}[coupon][id]", options_from_collection_for_select(Coupon.active, 'id', 'to_s') %>
        <%= hidden_field_tag "#{payment_name}[coupon][value]", session.price %>
      </span>
      <span id="<%= radio_name %>_free" style="display:none">
          <%= text_area_tag "#{payment_name}[free][note]", '', :rows => 2, :cols => 40, :placeholder => 'Anledning till gratis' %>
      </span>
    </span>
  </div>
  <%= hidden_field_tag "#{booking_name}[disable_validation]", true %>
</li>
